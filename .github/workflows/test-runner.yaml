name: Test Self-Hosted Runner

on:
  workflow_dispatch:

jobs:
  test:
    name: Test Runner & Cluster Access
    runs-on: self-hosted
    defaults:
      run:
        shell: powershell
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check runner environment
        run: |
          Write-Host "Información del runner:"
          Write-Host "Hostname: $env:COMPUTERNAME"
          Write-Host "Sistema operativo: $env:OS"
          Write-Host "Usuario actual: $env:USERNAME"
          Write-Host "Directorio de trabajo: $(Get-Location)"

      - name: Verify kubectl access
        run: |
          Write-Host "Verificando acceso a Kubernetes..."
          kubectl version --client
          kubectl config current-context

      - name: List Kubernetes namespaces
        run: |
          Write-Host "Namespaces de Kubernetes:"
          kubectl get namespaces

      - name: Check our environments
        run: |
          Write-Host "Comprobando los entornos del laboratorio:"
          kubectl get namespace dev,staging,prod

      - name: Success!
        run: |
          Write-Host "El runner funciona y tiene acceso al clúster!"
